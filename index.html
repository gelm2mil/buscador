<!DOCTYPE html>
<html lang="es">
<head>

<!-- ======================= ? PROTECCIÓN ANTI-ROBO ? ======================= -->
<script>
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("keydown", function(e){
    if(
        e.keyCode === 123 ||
        (e.ctrlKey && e.shiftKey && e.keyCode===73) ||
        (e.ctrlKey && e.shiftKey && e.keyCode===74) ||
        (e.ctrlKey && e.shiftKey && e.keyCode===67) ||
        (e.ctrlKey && e.keyCode===85) ||
        (e.ctrlKey && e.keyCode===83)
    ){
        e.preventDefault();
        return false;
    }
});
["copy","cut","paste","selectstart"].forEach(ev=>{
    document.addEventListener(ev, e => e.preventDefault());
});
</script>
<!-- ========================================================================== -->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONSULTA MULTAS CHIMALTENANGO</title>

<link rel="stylesheet" href="styles.css">

</head>
<body>

<div class="contenedor">

    <!-- ENCABEZADO COMPLETO -->
    <div class="header-top">
        <div class="logo-box">
            <img src="https://gelmhistoria.webcindario.com/multas/logoMUNI.jpg" alt="PMT">
        </div>

        <div class="titulos">
            <div class="titulos-linea1">MUNICIPALIDAD DE CHIMALTENANGO</div>
            <div class="titulos-linea2">MULTAS PENDIENTES DE PAGO</div>
            <div class="titulos-linea3">Sistema de Consulta  == BY GELM == ?</div>
            <div class="titulos-linea4">Busca tu placa. n.licencia o n.documento</div>
        </div>

        <div class="logo-box">
            <img src="https://gelmhistoria.webcindario.com/PMT/gelm.png" alt="GELM">
        </div>
    </div>

    <div id="estado">Cargando archivo...</div>

    <div class="buscador">
        <input id="busquedaInput" type="text"
            placeholder="Placa, licencia, DPI, documento o No. calcomanía...">
        <button id="btnBuscar">Buscar</button>
    </div>

    <p class="nota">
        Puedes escribir con o sin espacios / guiones:<br>
        <b>1918-61907-0805</b> = <b>1918619070805</b> ? 
        <b>M-098HJX</b> = <b>M098HJX</b>
    </p>

    <div id="resultado"></div>

    <div id="similaresBox" class="similares-box oculto">
        <span class="similares-label">SIMILARES:</span>
        <select id="similaresSelect">
            <option value="">-- seleccionar --</option>
        </select>
    </div>

    <div class="contacto-wrapper">
        <button class="btn-contacto" onclick="location.href='mailto:nerox2mil@proton.me'">
            <span class="icono">??</span>
            <span>Más información / Contactar a MUNICIPALIDAD DE CHIMALTENANGO</span>
        </button>
    </div>

</div>

<footer class="pie">
    <div>2014 - 2025 | BY GELM | Delegación de Transportes PMT</div>
    <div id="pie-linea2">att: ---[GELM]---</div>
    <div id="pie-fecha"></div>
</footer>

<script>
// ============= CARGAR JSON ==============
let datos = [];

fetch("https://gelmhistoria.webcindario.com/multas/placas.json")
    .then(res => res.json())
    .then(json => {
        datos = json;
        document.getElementById("estado").textContent = "Archivo cargado ?";
    })
    .catch(() => {
        document.getElementById("estado").textContent = "Error cargando información";
    });

function normalizar(txt){
    return txt.toString()
              .toLowerCase()
              .replace(/\s+/g, "")
              .replace(/-/g, "")
              .replace(/\./g, "");
}

document.getElementById("btnBuscar").addEventListener("click", buscar);

function buscar(){
    const q = normalizar(document.getElementById("busquedaInput").value);

    if(q.length < 2){
        alert("Ingrese mínimo 2 caracteres");
        return;
    }

    let resultados = datos.filter(row =>
        normalizar(row.placa).includes(q) ||
        normalizar(row.licencia).includes(q)
    );

    mostrarResultados(resultados);
}

function mostrarResultados(lista){
    const box = document.getElementById("resultado");
    const similaresBox = document.getElementById("similaresBox");
    const sel = document.getElementById("similaresSelect");

    box.innerHTML = "";
    sel.innerHTML = "<option value=''>-- seleccionar --</option>";
    similaresBox.classList.add("oculto");

    if(lista.length === 0){
        box.innerHTML = "<div class='nope'>? Sin resultados</div>";
        return;
    }

    if(lista.length === 1){
        box.innerHTML = generarTarjeta(lista[0]);
        return;
    }

    similaresBox.classList.remove("oculto");

    lista.forEach((row, i) => {
        let opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `${row.placa} ? ${row.conductor}`;
        sel.appendChild(opt);
    });

    sel.addEventListener("change", () => {
        if(sel.value !== ""){
            box.innerHTML = generarTarjeta(lista[sel.value]);
        }
    });
}

function generarTarjeta(r){
return `
<div class="tarjeta">
    <div class="campo"><b>Placa:</b> ${r.placa}</div>
    <div class="campo"><b>Licencia:</b> ${r.licencia}</div>
    <div class="campo"><b>Fecha:</b> ${r.fecha}</div>
    <div class="campo"><b>Hora:</b> ${r.hora}</div>
    <div class="campo"><b>Tipo:</b> ${r.tipo}</div>
    <div class="campo"><b>Marca:</b> ${r.marca}</div>
    <div class="campo"><b>Color:</b> ${r.color}</div>
    <div class="campo"><b>Conductor:</b> ${r.conductor}</div>
</div>
`;
}
</script>

</body>
</html>
