<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Buscador PMT - Placas y Licencias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --cian:#00ffe6;
  --verde:#00ff6a;
  --rojo:#ff0044;
  --bg:#050509;
  --panel:#05070b;
  --borde:#00ffe6;
  --text:#f5f5f5;
  --accent:#ffdd33;
  --danger:#ff4d6a;
  --radius:14px;
  --shadow:0 0 35px rgba(0,255,230,0.4);
  --shadow-soft:0 0 18px rgba(0,0,0,0.8);
}

*{box-sizing:border-box;margin:0;padding:0;}

body{
  min-height:100vh;
  background:radial-gradient(circle at top,#1b0033 0%,#000 45%,#020608 100%);
  color:var(--text);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:18px;
}

.app{
  width:100%;
  max-width:1080px;
  background:rgba(0,0,0,0.88);
  border-radius:22px;
  border:2px solid rgba(0,255,230,0.8);
  box-shadow:var(--shadow),0 0 90px rgba(0,0,0,0.9);
  padding:22px 18px 20px;
}

.app-header{
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:16px;
}

.app-title{
  font-size:20px;
  letter-spacing:2px;
  text-transform:uppercase;
  color:var(--cian);
  text-shadow:0 0 14px rgba(0,255,230,0.9);
}

.app-sub{
  font-size:11px;
  color:#a0f7ff;
  text-transform:uppercase;
}

.badge{
  font-size:11px;
  padding:3px 10px;
  border-radius:999px;
  border:1px solid rgba(0,255,230,0.6);
  background:linear-gradient(90deg,rgba(0,0,0,0.7),rgba(0,0,0,0.2));
  color:var(--accent);
}

.search-panel{
  margin-top:10px;
  display:grid;
  grid-template-columns:minmax(0,1.6fr) minmax(0,1.1fr) auto;
  gap:12px;
  align-items:end;
}

@media(max-width:780px){
  .search-panel{
    grid-template-columns:1fr;
  }
}

.field{
  display:flex;
  flex-direction:column;
  gap:5px;
}

label{
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:1px;
  color:#b0fafa;
}

input[type="text"]{
  background:#020308;
  border-radius:var(--radius);
  border:1px solid rgba(0,255,230,0.45);
  padding:10px 12px;
  font-size:15px;
  color:var(--text);
  box-shadow:var(--shadow-soft);
  outline:none;
}

input[type="text"]::placeholder{
  color:#788a90;
}

.mode-toggle{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  padding:9px 10px;
  border-radius:var(--radius);
  border:1px solid rgba(0,255,230,0.45);
  background:linear-gradient(135deg,rgba(0,0,0,0.85),rgba(0,10,20,0.96));
  box-shadow:var(--shadow-soft);
}

.mode-toggle label{
  display:flex;
  align-items:center;
  gap:4px;
  font-size:12px;
  color:#e1ffff;
}

.mode-toggle input{
  accent-color:var(--cian);
}

.btn{
  border:none;
  border-radius:var(--radius);
  padding:11px 18px;
  background:radial-gradient(circle at top,var(--cian) 0%,#0088ff 40%,#00142a 100%);
  color:#001015;
  font-weight:700;
  font-size:14px;
  cursor:pointer;
  text-transform:uppercase;
  letter-spacing:1px;
  box-shadow:0 0 16px rgba(0,255,230,0.8);
  transition:transform .12s ease-out,box-shadow .12s ease-out,filter .12s ease-out;
}

.btn:hover{
  transform:translateY(-1px) scale(1.02);
  box-shadow:0 0 24px rgba(0,255,230,1);
  filter:brightness(1.05);
}

.btn:active{
  transform:translateY(1px) scale(0.98);
  box-shadow:0 0 14px rgba(0,255,230,0.7);
}

.summary{
  margin-top:10px;
  font-size:12px;
  min-height:18px;
  color:#d0f9ff;
}

.results-panel{
  margin-top:16px;
  display:none;
}

.results-panel.active{
  display:block;
}

.results-header{
  font-size:12px;
  margin-bottom:6px;
  color:#bffcff;
}

#resultadoSelect{
  width:100%;
  background:#050910;
  color:var(--text);
  border-radius:var(--radius);
  border:1px solid rgba(0,255,230,0.55);
  padding:9px 10px;
  font-size:13px;
  box-shadow:var(--shadow-soft);
}

.detalle{
  margin-top:18px;
  padding:14px 14px 10px;
  border-radius:18px;
  background:linear-gradient(145deg,rgba(0,0,0,0.94),rgba(0,12,24,0.98));
  border:1px solid rgba(0,255,230,0.45);
  box-shadow:0 0 26px rgba(0,0,0,0.95),0 0 28px rgba(0,255,230,0.35);
}

.detalle-title{
  font-size:15px;
  margin-bottom:6px;
  color:var(--verde);
  text-shadow:0 0 10px rgba(0,255,106,0.8);
}

.detalle-sub{
  font-size:11px;
  margin-bottom:10px;
  color:#9be8ff;
}

.table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}

.table tr:nth-child(odd){
  background:rgba(255,255,255,0.02);
}

.table th, .table td{
  padding:4px 6px;
  text-align:left;
}

.table th{
  color:#8de8ff;
  font-weight:600;
  text-transform:uppercase;
  font-size:11px;
}

.table td{
  color:#f0faff;
}

.msg{
  margin-top:12px;
  font-size:12px;
}

.msg.error{
  color:var(--danger);
}

.msg.info{
  color:#b8f4ff;
}

.highlight{
  font-weight:600;
  color:var(--accent);
}

.footer{
  margin-top:10px;
  font-size:10px;
  text-align:right;
  color:#6fffee;
}
</style>
</head>

<body>
<div class="app">

  <div class="app-header">
    <div>
      <div class="app-title">Buscador PMT</div>
      <div class="app-sub">Placas · Número de licencia · Historial</div>
    </div>
    <div class="badge">Módulo independiente :: by gelm</div>
  </div>

  <div class="search-panel">
    <div class="field">
      <label for="query">Texto de búsqueda</label>
      <input id="query" type="text" placeholder="Ej: M-098HJX · 1918-61907-0805 · 1918619070805">
    </div>

    <div class="field">
      <label>Modo</label>
      <div class="mode-toggle">
        <label><input type="radio" name="mode" value="placa" checked> Por placa</label>
        <label><input type="radio" name="mode" value="licencia"> Por número de licencia</label>
      </div>
    </div>

    <div class="field">
      <button id="btnBuscar" class="btn">Buscar</button>
    </div>
  </div>

  <div id="summary" class="summary"></div>

  <div id="resultsPanel" class="results-panel">
    <div class="results-header">Coincidencias encontradas:</div>
    <select id="resultadoSelect" size="4"></select>
  </div>

  <div id="detalle" class="detalle" style="display:none;"></div>

  <div id="msg" class="msg info"></div>

  <div class="footer">PMT Chimaltenango • Módulo interno de consulta</div>

</div>

<script>
const DATA_URL = "placas.json";

let registros = [];
let ultimosResultados = [];

function normalizarPlaca(txt){
  return txt ? txt.toUpperCase().replace(/[^A-Z0-9]/g,"") : "";
}

function normalizarLicencia(txt){
  return txt ? txt.replace(/[^A-Za-z0-9]/g,"") : "";
}

async function cargarDatos(){
  try{
    const resp = await fetch(DATA_URL,{cache:"no-store"});
    registros = await resp.json();
    document.getElementById("msg").textContent =
      "Base cargada: " + registros.length + " registros disponibles.";
  }catch(e){
    document.getElementById("msg").textContent =
    "Error cargando la base de datos (placas.json).";
    document.getElementById("msg").className = "msg error";
  }
}

function buscar(){
  const qRaw = document.getElementById("query").value.trim();
  const mode = document.querySelector("input[name='mode']:checked").value;
  const summary = document.getElementById("summary");
  const msg = document.getElementById("msg");
  const panel = document.getElementById("resultsPanel");
  const select = document.getElementById("resultadoSelect");
  const detalle = document.getElementById("detalle");

  detalle.style.display = "none";
  detalle.innerHTML = "";
  panel.classList.remove("active");
  select.innerHTML = "";
  msg.textContent = "";
  msg.className = "msg info";

  if(!qRaw){
    summary.textContent = "";
    msg.textContent = "Escribe una placa o número de licencia para iniciar la búsqueda.";
    return;
  }

  let qNorm = mode === "placa" ? normalizarPlaca(qRaw) : normalizarLicencia(qRaw);

  if(!qNorm){
    summary.textContent = "";
    msg.textContent = "El texto ingresado no contiene caracteres válidos.";
    return;
  }

  let resultados = mode === "placa"
    ? registros.filter(r => r.placa_norm && r.placa_norm.includes(qNorm))
    : registros.filter(r => r.licencia_norm && r.licencia_norm.includes(qNorm));

  ultimosResultados = resultados;

  if(!resultados.length){
    summary.innerHTML = 'Sin resultados para <span class="highlight">'+qRaw+'</span>.';
    msg.textContent = "Verifica si la placa o licencia está bien escrita.";
    msg.className = "msg error";
    return;
  }

  summary.innerHTML =
    'Se encontraron <span class="highlight">'+resultados.length+
    "</span> coincidencia(s) para <span class='highlight'>"+qRaw+"</span>";

  if(resultados.length === 1){
    mostrarDetalle(resultados[0]);
  }else{
    panel.classList.add("active");
    resultados.forEach((r,idx)=>{
      const opt = document.createElement("option");
      opt.value = idx;
      opt.textContent =
        (r.placa || "SIN PLACA")+" | Lic: "+(r.licencia || "SIN LICENCIA")+
        " | Boleta: "+(r.boleta || "")+" | "+(r.fecha || "");
      select.appendChild(opt);
    });
    select.selectedIndex = 0;
    mostrarDetalle(resultados[0]);
  }
}

function mostrarDetalle(reg){
  const detalle = document.getElementById("detalle");
  detalle.style.display = "block";

  detalle.innerHTML = `
    <div class="detalle-title">Placa ${reg.placa || "SIN PLACA"}</div>
    <div class="detalle-sub">No. licencia: <span class="highlight">${reg.licencia || "SIN LICENCIA"}</span>
    · Boleta: ${reg.boleta || ""} · Fecha: ${reg.fecha || ""} · Hora: ${reg.hora || ""}</div>

    <table class="table">
      <tbody>
        <tr><th>Serie</th><td>${reg.serie || ""}</td></tr>
        <tr><th>Tipo</th><td>${reg.tipo || ""}</td></tr>
        <tr><th>Marca</th><td>${reg.marca || ""}</td></tr>
        <tr><th>Color</th><td>${reg.color || ""}</td></tr>
        <tr><th>Dirección</th><td>${reg.direccion || ""}</td></tr>
        <tr><th>Departamento</th><td>${reg.departamento || ""}</td></tr>
        <tr><th>Municipio</th><td>${reg.municipio || ""}</td></tr>
        <tr><th>Conductor</th><td>${reg.conductor || ""}</td></tr>
        <tr><th>Artículo</th><td>${reg.articulo || ""}</td></tr>
        <tr><th>Descripción</th><td>${reg.descripcion || ""}</td></tr>
        <tr><th>Chapa</th><td>${reg.chapa || ""}</td></tr>
      </tbody>
    </table>
  `;
}

document.getElementById("btnBuscar").addEventListener("click", buscar);
document.getElementById("query").addEventListener("keydown", e=>{
  if(e.key === "Enter") buscar();
});

document.getElementById("resultadoSelect").addEventListener("change", e=>{
  const idx = parseInt(e.target.value,10);
  if(ultimosResultados[idx]) mostrarDetalle(ultimosResultados[idx]);
});

cargarDatos();
</script>

</body>
</html>
